---
import '../styles/global.css';
import Navigation from '../components/Navigation.astro';
import { Image } from 'astro:assets';
import rendu06 from '/src/img/Mockup Produit Studio (1).png';
import rendu07 from '/Users/selmahaoual/Documents/GitHub/Threejs/src/img/Mockup Minimaliste (1).png';
import rendu08 from '/Users/selmahaoual/Documents/GitHub/Threejs/src/img/Mockup Lifestyle (1).png';

/* Si tu as des photos réelles, importe-les ici (optionnel) */
import real01 from '/src/img/Mockup Créatif (1).png';
import real02 from '/Users/selmahaoual/Documents/GitHub/Threejs/src/img/Mockup Flat Lay (1).png';
---

<html lang="fr">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>Projet Tasse 3D – Blender & Three.js</title>
	</head>
	<body class="bg-gray-900 text-white">
		<Navigation />

		
		<!-- Sections pour le scroll -->
		<div class="relative">

 <!-- 1. Présentation -->

	  <section class="min-h-screen flex items-center relative z-10 px-10">
				<div class="max-w-3xl bg-black/60 backdrop-blur-md p-10 rounded-2xl">
					<h1 class="text-4xl font-bold mb-6">Tasse en céramique – Modélisation 3D</h1>
					<p class="text-gray-300 leading-relaxed">
						Ce projet présente la modélisation d’une tasse en céramique réalisée sur Blender.
						L’objectif était de reproduire un objet du quotidien en respectant ses proportions,
						sa forme et son matériau, puis de l’intégrer dans une scène 3D interactive.
					</p>
					<p class="text-gray-300 leading-relaxed mt-4">
						La tasse est volontairement simple afin de mettre en valeur le travail de volume,
						de surface et d’éclairage, ainsi que son intégration en temps réel sur le web.
					</p>
				</div>
			</section>

			<section class="h-screen flex items-center ml-10 justify-center">
				<canvas id="canvas3d" class="fixed top-0 left-0 w-full h-screen"></canvas>
			</section>
			<section class="h-screen flex items-center ml-10 relative z-10">
				<div class="bg-black/50 backdrop-blur-md p-8 rounded-2xl max-w-md">
					<h3 class="text-2xl font-bold text-white mb-4">Intégration 3D temps réel</h3>
					<Image src={rendu06} alt="Rendu de face" class="w-full h-48 object-cover rounded-lg mb-4" />
					<p class="text-gray-300">La tasse est intégrée sur le site grâce à la librairie Three.js. Le modèle 3D,
						exporté depuis Blender au format GLB, est affiché en temps réel dans le navigateur.</p>
				<p class="text-gray-300 leading-relaxed mt-4">
						Une animation contrôlée par le scroll permet de faire tourner l’objet et la caméra
						autour de celui-ci, offrant une exploration fluide et immersive du modèle.
					</p>
				</div>
			</section>

			<section class="h-screen flex items-center ml-10 relative z-10">
				<div class="bg-black/50 backdrop-blur-md p-8 rounded-2xl max-w-md">
					<h3 class="text-2xl font-bold text-white mb-4">Processus de création</h3>
					<Image src={rendu07} alt="Rendu latéral" class="w-full h-48 object-cover rounded-lg mb-4" />
					<p class="text-gray-300">La tasse a été modélisée à partir de formes de base dans Blender. Des techniques
						comme l’extrusion, la subdivision et le lissage ont été utilisées afin d’obtenir
						des courbes propres et un rendu harmonieux.</p>

						<p class="text-gray-300 leading-relaxed mt-4">
						Un matériau de type céramique a ensuite été appliqué, avec un léger effet de
						réflexion. Le modèle a été exporté au format GLB afin d’assurer de bonnes
						performances sur le web.
					</p>
				</div>
			</section>


			<section class="h-screen flex items-center ml-10 relative z-10">
				<div class="bg-black/50 backdrop-blur-md p-8 rounded-2xl max-w-md">
					<h3 class="text-2xl font-bold text-white mb-4">Vue Finale</h3>
					<Image src={rendu08} alt="Rendu final" class="w-full h-48 object-cover rounded-lg mb-4" />
					<p class="text-gray-300">L'orchestration complète révélée avec un éclairage dynamique et des effets atmosphériques.</p>
				</div>
			</section>
----- A MODIFIER -----

			<!-- VUE DE FACE -->
			<section class="h-screen flex items-center ml-10 relative z-10">
				<div class="bg-black/50 backdrop-blur-md p-8 rounded-2xl max-w-md">
					<h3 class="text-2xl font-bold mb-4">Vue de face</h3>
					<Image src={rendu06} alt="Rendu de face" class="w-full h-48 object-cover rounded-lg mb-4" />
					<p class="text-gray-300">
						Cette vue met en avant les proportions générales de la tasse ainsi que la lecture
						du matériau sous un éclairage studio.
					</p>
				</div>
			</section>

			<!-- VUE LATÉRALE -->
			<section class="h-screen flex items-center ml-10 relative z-10">
				<div class="bg-black/50 backdrop-blur-md p-8 rounded-2xl max-w-md">
					<h3 class="text-2xl font-bold mb-4">Vue latérale</h3>
					<Image src={rendu07} alt="Rendu latéral" class="w-full h-48 object-cover rounded-lg mb-4" />
					<p class="text-gray-300">
						La vue latérale permet d’observer le travail effectué sur l’anse et l’épaisseur
						des parois.
					</p>
				</div>
			</section>

			<!-- VUE FINALE -->
			<section class="h-screen flex items-center ml-10 relative z-10">
				<div class="bg-black/50 backdrop-blur-md p-8 rounded-2xl max-w-md">
					<h3 class="text-2xl font-bold mb-4">Vue finale</h3>
					<Image src={rendu08} alt="Rendu final" class="w-full h-48 object-cover rounded-lg mb-4" />
					<p class="text-gray-300">
						Rendu final intégrant l’éclairage, l’environnement HDR et l’animation complète.
					</p>
				</div>
			</section>


			<!-- 2. Photos réelles (référence) -->
      <section class="relative z-10 py-24 px-10 bg-gray-950">
        <h2 class="text-3xl font-bold text-center mb-8">Photos de référence</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto">
          <Image src={real01} alt="Photo réelle de la tasse" class="rounded-xl object-cover" />
          <Image src={real02} alt="Photo réelle de la tasse" class="rounded-xl object-cover" />
        </div>
        <p class="text-gray-400 text-center mt-8 max-w-2xl mx-auto">
          Ces photos ont servi de référence pour la forme, l'anse et le matériau.
        </p>
      </section>
		</div>
	</body>
</html>

<script>
	// Importation des bibliothèques nécessaires
	import * as THREE from 'three';
	import { gsap } from 'gsap';
	import { ScrollTrigger } from 'gsap/ScrollTrigger';
	import { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js';
  // Importation du loader pour les textures HDR (High Dynamic Range)
	import { RGBELoader } from 'three/examples/jsm/loaders/RGBELoader.js';

	// Enregistrement du plugin ScrollTrigger
	gsap.registerPlugin(ScrollTrigger);

	// === CONFIGURATION DE BASE ===
	
	// Récupération du canvas HTML
	const canvas = document.getElementById('canvas3d') as HTMLCanvasElement;
	
	// Création de la scène
	const scene = new THREE.Scene();
	scene.background = new THREE.Color(0x0a0a1a);
	scene.fog = new THREE.Fog(0x0a0a1a, 10, 50);

	// Configuration de la caméra
	const camera = new THREE.PerspectiveCamera(
		35,
		window.innerWidth / window.innerHeight,
		0.1,
		1000
	);
	camera.position.set(0, 1, 5);

	// Configuration du renderer
	const renderer = new THREE.WebGLRenderer({ 
		canvas,
		antialias: true,
		alpha: true
	});
	renderer.setSize(window.innerWidth, window.innerHeight);
	renderer.setPixelRatio(window.devicePixelRatio);
	renderer.shadowMap.enabled = true;
	renderer.shadowMap.type = THREE.PCFSoftShadowMap;
	renderer.toneMapping = THREE.ACESFilmicToneMapping;
	renderer.toneMappingExposure = 1.2;

  // === CHARGEMENT DE LA TEXTURE D'ENVIRONNEMENT HDR ===
	
	// Création d'un loader pour les textures HDR (format RGBE)
	const rgbeLoader = new RGBELoader();
	// Chargement asynchrone de la texture HDR d'environnement
	rgbeLoader.load(
		// URL de la texture HDR (studio lighting)
		'https://dl.polyhaven.org/file/ph-assets/HDRIs/hdr/1k/studio_small_08_1k.hdr',
		(texture) => {
			// Configuration de la texture en mapping équirectangulaire
			texture.mapping = THREE.EquirectangularReflectionMapping;
			// Application de la texture comme environnement de la scène
			// Cela fournit l'éclairage IBL (Image Based Lighting) et les reflets
			scene.environment = texture;
			// Optionnel: utiliser aussi comme fond (commenté pour garder le fond bleu)
			// scene.background = texture;
		}
	);

	// === CHARGEMENT DU MODÈLE 3D ===
	
	// Groupe principal pour contenir le modèle
	const mainGroup = new THREE.Group();
	scene.add(mainGroup);

	// Loader pour fichiers GLTF/GLB
	const gltfLoader = new GLTFLoader();
	let loadedModel: THREE.Group;

	// Chargement du modèle depuis le dossier public
	gltfLoader.load(
		'/TP_Blender_Mug (2).glb',
		(gltf) => {
			loadedModel = gltf.scene;
			
			// Configuration du modèle - centré au milieu de la scène
			loadedModel.scale.set(0.6, 0.6, 0.6);
			loadedModel.position.set(1.3, -1, 0);
			
			// Activation des ombres pour tous les meshes
			loadedModel.traverse((child) => {
				if (child instanceof THREE.Mesh) {
					child.castShadow = true;
					child.receiveShadow = true;
					// Amélioration des matériaux si nécessaire
					if (child.material) {
						child.material.envMapIntensity = 1.5;
					}
				}
			});
			
			mainGroup.add(loadedModel);
		},
		// Callback de progression
		(progress) => {
			console.log('Chargement: ' + (progress.loaded / progress.total * 100) + '%');
		},
		// Callback d'erreur
		(error) => {
			console.error('Erreur de chargement du modèle:', error);
		}
	);

	// === SYSTÈME D'ÉCLAIRAGE ===
	
	// Lumière ambiante pour éclairer légèrement toute la scène
	const ambientLight = new THREE.AmbientLight(0x404080, 0.8);
	scene.add(ambientLight);

	// Lumière directionnelle principale (éclairage du haut)
	const directionalLight = new THREE.DirectionalLight(0xffffff, 5);
	directionalLight.position.set(10, 10, 10);
	directionalLight.castShadow = true;
	directionalLight.shadow.mapSize.width = 2048;
	directionalLight.shadow.mapSize.height = 2048;
	scene.add(directionalLight);

	// Lumière ponctuelle rose (accent gauche)
	const pointLight1 = new THREE.PointLight(0xff6b9d, 3, 30);
	pointLight1.position.set(-5, 3, 5);
	scene.add(pointLight1);

	// Lumière ponctuelle cyan (accent droit)
	const pointLight2 = new THREE.PointLight(0x4ecdc4, 3, 30);
	pointLight2.position.set(5, 3, 5);
	scene.add(pointLight2);

	// Lumière arrière pour le rim lighting
	const rimLight = new THREE.SpotLight(0xffffff, 2);
	rimLight.position.set(0, 5, -5);
	rimLight.angle = Math.PI / 6;
	scene.add(rimLight);

	// === SOL CIRCULAIRE ===
	
	// const groundGeometry = new THREE.CircleGeometry(8, 64);
	// const groundMaterial = new THREE.MeshStandardMaterial({
	// 	color: 0x1a1a2e,
	// 	metalness: 0,
	// 	roughness: 1
	// });
	// const ground = new THREE.Mesh(groundGeometry, groundMaterial);
	// ground.rotation.x = -Math.PI / 2;
	// ground.position.y = -1;
	// ground.receiveShadow = true;
	// scene.add(ground);

	// === SCROLLTRIGGER ANIMATIONS ===
	
	// ✅ SCROLL ANIMATION — ROTATION DE LA TASSE
gsap.timeline({
	scrollTrigger: {
		trigger: 'body',
		start: 'top top',
		end: 'bottom bottom',
		scrub: 1,
	}
}).to(mainGroup.rotation, {
	y: Math.PI * 0.5,
	ease: 'none'
});

// Resize
window.addEventListener('resize', () => {
	camera.aspect = window.innerWidth / window.innerHeight;
	camera.updateProjectionMatrix();
	renderer.setSize(window.innerWidth, window.innerHeight);
});

// Render loop
function animate() {
	requestAnimationFrame(animate);
	camera.lookAt(0, 0, 0);
	renderer.render(scene, camera);
}
animate();
</script>